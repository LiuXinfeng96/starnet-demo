/*! 
 Build based on gin-vue-admin 
 Time : 1671785957000 */
import e from"./fieldDialog.02806641.js";import l from"./previewCodeDialg.1476f85f.js";import{a,b as t,t as i,c as u}from"./stringFun.2b3a18f6.js";import{p as o,c as d,g as s,a as n,b as r,d as m,e as p}from"./autoCode.fbdd81d7.js";import{u as c}from"./dictionary.8dcfcd04.js";import{_ as v,V as f,u as b,a as g,r as y,I as N,g as _,o as h,c as k,d as V,b as w,w as x,h as C,F as T,v as D,l as B,y as U,e as z,i as S,a7 as F,p as q,q as j,a8 as L}from"./index.860b48e6.js";import{W as A}from"./warningBar.87352cd1.js";import"./sysDictionary.12ad4d06.js";const J=e=>(q("data-v-bcb13437"),e=e(),j(),e),O={class:"gva-search-box"},M={style:{fontSize:"16px",paddingLeft:"20px"}},R={style:{float:"right",color:"#8492a6","font-size":"13px"}},E={class:"gva-search-box"},I={style:{float:"right",color:"#8492a6","font-size":"13px"}},P=J((()=>w("div",null," 自动创建API ",-1))),$=J((()=>w("div",null," 自动移动文件 ",-1))),X={class:"gva-table-box"},G={class:"gva-btn-list"},Q=J((()=>w("p",null,"确定删除吗？",-1))),W={style:{"text-align":"right","margin-top":"8px"}},H={class:"gva-btn-list justify-content-flex-end auto-btn-list"},K={class:"dialog-footer"},Y={class:"previewCodeTool"},Z=J((()=>w("p",null,"操作栏：",-1))),ee={class:"dialog-footer",style:{"padding-top":"14px","padding-right":"14px"}},le={name:"AutoCode"},ae=v(Object.assign(le,{setup(v){const q={fieldName:"",fieldDesc:"",fieldType:"",dataType:"",fieldJson:"",columnName:"",dataTypeLong:"",comment:"",require:!1,sort:!1,errorText:"",clearable:!0,fieldSearchType:"",dictType:""},j=f(),J=b(),le=g([]),ae=y({}),te=y({businessDB:"",dbName:"",tableName:""}),ie=y([]),ue=y(""),oe=y({}),de=y({structName:"",tableName:"",packageName:"",package:"",abbreviation:"",description:"",businessDB:"",autoCreateApiToSql:!0,autoMoveFile:!0,autoCreateResource:!1,fields:[]}),se=y({structName:[{required:!0,message:"请输入结构体名称",trigger:"blur"}],abbreviation:[{required:!0,message:"请输入结构体简称",trigger:"blur"}],description:[{required:!0,message:"请输入结构体描述",trigger:"blur"}],packageName:[{required:!0,message:"文件名称：sysXxxxXxxx",trigger:"blur"}],package:[{required:!0,message:"请选择package",trigger:"blur"}]}),ne=y({}),re=y({}),me=y(!1),pe=y(!1),ce=y(null),ve=()=>{ce.value.selectText()},fe=()=>{ce.value.copy()},be=e=>{me.value=!0,e?(ue.value="edit",re.value=JSON.parse(JSON.stringify(e)),ne.value=e):(ue.value="add",ne.value=JSON.parse(JSON.stringify(q)))},ge=L(),ye=()=>{ge.refs.fieldDialogNode.fieldDialogFrom.validate((e=>{if(!e)return!1;ne.value.fieldName=t(ne.value.fieldName),"add"===ue.value&&de.value.fields.push(ne.value),me.value=!1}))},Ne=()=>{"edit"===ue.value&&(ne.value=re.value),me.value=!1},_e=y(null),he=async e=>de.value.fields.length<=0?(S({type:"error",message:"请填写至少一个field"}),!1):de.value.fields.some((e=>e.fieldName===de.value.structName))?(S({type:"error",message:"存在与结构体同名的字段"}),!1):void _e.value.validate((async l=>{var u;if(!l)return!1;for(const e in de.value)"string"==typeof de.value[e]&&(de.value[e]=de.value[e].trim());if(de.value.structName=t(de.value.structName),de.value.tableName=de.value.tableName.replace(" ",""),de.value.tableName||(de.value.tableName=i(a(de.value.structName))),de.value.structName===de.value.abbreviation)return S({type:"error",message:"structName和struct简称不能相同"}),!1;if(de.value.humpPackageName=i(de.value.packageName),e){const e=await o(de.value);ae.value=e.data.autoCode,pe.value=!0}else{const e=await d(de.value);if("false"===(null==(u=e.headers)?void 0:u.success))return;if(de.value.autoMoveFile)return void S({type:"success",message:"自动化代码创建成功，自动移动成功"});S({type:"success",message:"自动化代码创建成功，正在下载"});const l=new Blob([e]),a="ginvueadmin.zip";if("download"in document.createElement("a")){const e=window.URL.createObjectURL(l),t=document.createElement("a");t.style.display="none",t.href=e,t.setAttribute("download",a),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e)}else window.navigator.msSaveBlob(l,a)}})),ke=y([]),Ve=y([]),we=async()=>{te.value.dbName="",te.value.tableName="";const e=await s({businessDB:te.value.businessDB});0===e.code&&(Ve.value=e.data.dbs,ke.value=e.data.dbList)},xe=async()=>{const e=await n({businessDB:te.value.businessDB,dbName:te.value.dbName});0===e.code&&(ie.value=e.data.tables),te.value.tableName=""},Ce=async()=>{const e=["id","created_at","updated_at","deleted_at"],l=await r(te.value);if(0===l.code){let a="";if(""!==te.value.businessDB){const e=ke.value.find((e=>e.aliasName===te.value.businessDB));console.log(e);const l=F(e);console.log(l),a=l.dbtype}const i=u(te.value.tableName);de.value.structName=t(i),de.value.tableName=te.value.tableName,de.value.packageName=i,de.value.abbreviation=i,de.value.description=i+"表",de.value.autoCreateApiToSql=!0,de.value.autoMoveFile=!0,de.value.fields=[],l.data.columns&&l.data.columns.forEach((l=>{if(!e.some((e=>e===l.columnName))){const e=u(l.columnName);de.value.fields.push({fieldName:t(e),fieldDesc:l.columnComment||e+"字段",fieldType:oe.value[l.dataType],dataType:l.dataType,fieldJson:e,dataTypeLong:l.dataTypeLong&&l.dataTypeLong.split(",")[0],columnName:"oracle"==a?l.columnName.toUpperCase():l.columnName,comment:l.columnComment,require:!1,errorText:"",clearable:!0,fieldSearchType:"",dictType:""})}}))}},Te=async()=>{["string","int","bool","float64","time.Time"].forEach((async e=>{const l=await(async e=>{const l=c();return await l.getDictionary(e),l.dictionaryMap[e]})(e);l&&l.forEach((l=>{oe.value[l.label]=e}))}))},De=y([]),Be=async()=>{const e=await m();0===e.code&&(De.value=e.data.pkgs)},Ue=()=>{J.push({name:"autoPkg"})},ze=()=>{we(),Te(),Be();const e=j.params.id;e&&(async e=>{const l=await p({id:Number(e)});0===l.code&&(de.value=JSON.parse(l.data.meta))})(e)};return ze(),N((()=>j.params.id),(e=>{"autoCodeEdit"===j.name&&ze()})),(t,i)=>{const u=_("pointer"),o=_("el-icon"),d=_("QuestionFilled"),s=_("el-tooltip"),n=_("el-option"),r=_("el-select"),m=_("el-form-item"),p=_("el-button"),c=_("el-form"),v=_("el-collapse-item"),f=_("el-collapse"),b=_("el-input"),g=_("refresh"),y=_("document-add"),N=_("el-checkbox"),S=_("el-table-column"),F=_("el-popover"),q=_("el-table"),j=_("el-dialog");return h(),k("div",null,[V(A,{href:"https://www.bilibili.com/video/BV1kv4y1g7nT?p=3",title:"此功能为开发环境使用，不建议发布到生产，具体使用效果请看视频https://www.bilibili.com/video/BV1kv4y1g7nT?p=3"}),w("div",O,[V(f,{modelValue:le,"onUpdate:modelValue":i[3]||(i[3]=e=>le=e),style:{"margin-bottom":"12px"}},{default:x((()=>[V(v,{name:"1"},{title:x((()=>[w("div",M,[C(" 点这里从现有数据库创建代码 "),V(o,{class:"header-icon"},{default:x((()=>[V(u)])),_:1})])])),default:x((()=>[V(c,{ref:"getTableForm",style:{"margin-top":"24px"},inline:!0,model:te.value,"label-width":"120px"},{default:x((()=>[V(m,{label:"业务库",prop:"selectDBtype"},{label:x((()=>[V(s,{content:"注：需要提前到db-list自行配置多数据库，如未配置需配置后重启服务方可使用。（此处可选择对应库表，可理解为从哪个库选择表）",placement:"bottom",effect:"light"},{default:x((()=>[w("div",null,[C(" 业务库 "),V(o,null,{default:x((()=>[V(d)])),_:1})])])),_:1})])),default:x((()=>[V(r,{modelValue:te.value.businessDB,"onUpdate:modelValue":i[0]||(i[0]=e=>te.value.businessDB=e),clearable:"",style:{width:"194px"},placeholder:"选择业务库",onChange:we},{default:x((()=>[(h(!0),k(T,null,D(ke.value,(e=>(h(),B(n,{key:e.aliasName,value:e.aliasName,label:e.aliasName,disabled:e.disable},{default:x((()=>[w("div",null,[w("span",null,U(e.aliasName),1),w("span",R,U(e.dbName),1)])])),_:2},1032,["value","label","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(m,{label:"数据库名",prop:"structName"},{default:x((()=>[V(r,{modelValue:te.value.dbName,"onUpdate:modelValue":i[1]||(i[1]=e=>te.value.dbName=e),clearable:"",filterable:"",placeholder:"请选择数据库",onChange:xe},{default:x((()=>[(h(!0),k(T,null,D(Ve.value,(e=>(h(),B(n,{key:e.database,label:e.database,value:e.database},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(m,{label:"表名",prop:"structName"},{default:x((()=>[V(r,{modelValue:te.value.tableName,"onUpdate:modelValue":i[2]||(i[2]=e=>te.value.tableName=e),disabled:!te.value.dbName,filterable:"",placeholder:"请选择表"},{default:x((()=>[(h(!0),k(T,null,D(ie.value,(e=>(h(),B(n,{key:e.tableName,label:e.tableName,value:e.tableName},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1}),V(m,null,{default:x((()=>[V(p,{size:"small",type:"primary",onClick:Ce},{default:x((()=>[C("使用此表创建")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["modelValue"])]),w("div",E,[V(c,{ref_key:"autoCodeForm",ref:_e,rules:se.value,model:de.value,"label-width":"120px",inline:!0},{default:x((()=>[V(m,{label:"Struct名称",prop:"structName"},{default:x((()=>[V(b,{modelValue:de.value.structName,"onUpdate:modelValue":i[4]||(i[4]=e=>de.value.structName=e),placeholder:"首字母自动转换大写"},null,8,["modelValue"])])),_:1}),V(m,{label:"TableName",prop:"tableName"},{default:x((()=>[V(b,{modelValue:de.value.tableName,"onUpdate:modelValue":i[5]||(i[5]=e=>de.value.tableName=e),placeholder:"指定表名（非必填）"},null,8,["modelValue"])])),_:1}),V(m,{label:"Struct简称",prop:"abbreviation"},{default:x((()=>[V(b,{modelValue:de.value.abbreviation,"onUpdate:modelValue":i[6]||(i[6]=e=>de.value.abbreviation=e),placeholder:"简称会作为入参对象名和路由group"},null,8,["modelValue"])])),_:1}),V(m,{label:"Struct中文名称",prop:"description"},{default:x((()=>[V(b,{modelValue:de.value.description,"onUpdate:modelValue":i[7]||(i[7]=e=>de.value.description=e),placeholder:"中文描述作为自动api描述"},null,8,["modelValue"])])),_:1}),V(m,{label:"文件名称",prop:"packageName"},{default:x((()=>[V(b,{modelValue:de.value.packageName,"onUpdate:modelValue":i[8]||(i[8]=e=>de.value.packageName=e),placeholder:"生成文件的默认名称(建议为驼峰格式,首字母小写,如sysXxxXxxx)",onBlur:i[9]||(i[9]=e=>{var l,t;(l=de.value)[t="packageName"]=a(l[t])})},null,8,["modelValue"])])),_:1}),V(m,{label:"Package（包）",prop:"package"},{default:x((()=>[V(r,{modelValue:de.value.package,"onUpdate:modelValue":i[10]||(i[10]=e=>de.value.package=e),style:{width:"194px"}},{default:x((()=>[(h(!0),k(T,null,D(De.value,(e=>(h(),B(n,{key:e.ID,value:e.packageName,label:e.packageName},null,8,["value","label"])))),128))])),_:1},8,["modelValue"]),V(o,{class:"auto-icon",onClick:Be},{default:x((()=>[V(g)])),_:1}),V(o,{class:"auto-icon",onClick:Ue},{default:x((()=>[V(y)])),_:1})])),_:1}),V(m,{label:"业务库",prop:"businessDB"},{label:x((()=>[V(s,{content:"注：需要提前到db-list自行配置多数据库，此项为空则会使用gva本库创建自动化代码(global.GVA_DB),填写后则会创建指定库的代码(global.MustGetGlobalDBByDBName(dbname))",placement:"bottom",effect:"light"},{default:x((()=>[w("div",null,[C(" 业务库 "),V(o,null,{default:x((()=>[V(d)])),_:1})])])),_:1})])),default:x((()=>[V(r,{modelValue:de.value.businessDB,"onUpdate:modelValue":i[11]||(i[11]=e=>de.value.businessDB=e),style:{width:"194px"},placeholder:"选择业务库"},{default:x((()=>[(h(!0),k(T,null,D(ke.value,(e=>(h(),B(n,{key:e.aliasName,value:e.aliasName,label:e.aliasName,disabled:e.disable},{default:x((()=>[w("div",null,[w("span",null,U(e.aliasName),1),w("span",I,U(e.dbName),1)])])),_:2},1032,["value","label","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(m,null,{label:x((()=>[V(s,{content:"注：会自动在结构体添加 created_by updated_by deleted_by，方便用户进行资源权限控制",placement:"bottom",effect:"light"},{default:x((()=>[w("div",null,[C(" 创建资源标识 "),V(o,null,{default:x((()=>[V(d)])),_:1})])])),_:1})])),default:x((()=>[V(N,{modelValue:de.value.autoCreateResource,"onUpdate:modelValue":i[12]||(i[12]=e=>de.value.autoCreateResource=e)},null,8,["modelValue"])])),_:1}),V(m,null,{label:x((()=>[V(s,{content:"注：把自动生成的API注册进数据库",placement:"bottom",effect:"light"},{default:x((()=>[P])),_:1})])),default:x((()=>[V(N,{modelValue:de.value.autoCreateApiToSql,"onUpdate:modelValue":i[13]||(i[13]=e=>de.value.autoCreateApiToSql=e)},null,8,["modelValue"])])),_:1}),V(m,null,{label:x((()=>[V(s,{content:"注：自动迁移生成的文件到yaml配置的对应位置",placement:"bottom",effect:"light"},{default:x((()=>[$])),_:1})])),default:x((()=>[V(N,{modelValue:de.value.autoMoveFile,"onUpdate:modelValue":i[14]||(i[14]=e=>de.value.autoMoveFile=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","model"])]),w("div",X,[w("div",G,[V(p,{size:"small",type:"primary",onClick:i[15]||(i[15]=e=>be())},{default:x((()=>[C("新增Field")])),_:1})]),V(q,{data:de.value.fields},{default:x((()=>[V(S,{align:"left",type:"index",label:"序列",width:"60"}),V(S,{align:"left",prop:"fieldName",label:"Field名"}),V(S,{align:"left",prop:"fieldDesc",label:"中文名"}),V(S,{align:"left",prop:"require",label:"是否必填"},{default:x((({row:e})=>[C(U(e.require?"是":"否"),1)])),_:1}),V(S,{align:"left",prop:"sort",label:"是否排序"},{default:x((({row:e})=>[C(U(e.sort?"是":"否"),1)])),_:1}),V(S,{align:"left",prop:"fieldJson","min-width":"120px",label:"FieldJson"}),V(S,{align:"left",prop:"fieldType",label:"Field数据类型",width:"130"}),V(S,{align:"left",prop:"dataTypeLong",label:"数据库字段长度",width:"130"}),V(S,{align:"left",prop:"columnName",label:"数据库字段",width:"130"}),V(S,{align:"left",prop:"comment",label:"数据库字段描述",width:"130"}),V(S,{align:"left",prop:"fieldSearchType",label:"搜索条件",width:"130"}),V(S,{align:"left",prop:"dictType",label:"字典",width:"130"}),V(S,{align:"left",label:"操作",width:"300",fixed:"right"},{default:x((e=>[V(p,{size:"small",type:"primary",link:"",icon:"edit",onClick:l=>be(e.row)},{default:x((()=>[C("编辑")])),_:2},1032,["onClick"]),V(p,{size:"small",type:"primary",link:"",disabled:0===e.$index,onClick:l=>(e=>{if(0===e)return;const l=de.value.fields[e-1];de.value.fields.splice(e-1,1),de.value.fields.splice(e,0,l)})(e.$index)},{default:x((()=>[C("上移")])),_:2},1032,["disabled","onClick"]),V(p,{size:"small",type:"primary",link:"",disabled:e.$index+1===de.value.fields.length,onClick:l=>(e=>{if(e===de.value.fields.length-1)return;const l=de.value.fields[e+1];de.value.fields.splice(e+1,1),de.value.fields.splice(e,0,l)})(e.$index)},{default:x((()=>[C("下移")])),_:2},1032,["disabled","onClick"]),V(F,{modelValue:e.row.visible,"onUpdate:modelValue":l=>e.row.visible=l,placement:"top"},{reference:x((()=>[V(p,{size:"small",type:"primary",link:"",icon:"delete",onClick:l=>e.row.visible=!0},{default:x((()=>[C("删除")])),_:2},1032,["onClick"])])),default:x((()=>[Q,w("div",W,[V(p,{size:"small",type:"primary",link:"",onClick:l=>e.row.visible=!1},{default:x((()=>[C("取消")])),_:2},1032,["onClick"]),V(p,{type:"primary",size:"small",onClick:l=>{return a=e.$index,void de.value.fields.splice(a,1);var a}},{default:x((()=>[C("确定")])),_:2},1032,["onClick"])])])),_:2},1032,["modelValue","onUpdate:modelValue"])])),_:1})])),_:1},8,["data"]),w("div",H,[V(p,{size:"small",type:"primary",onClick:i[16]||(i[16]=e=>he(!0))},{default:x((()=>[C("预览代码")])),_:1}),V(p,{size:"small",type:"primary",onClick:i[17]||(i[17]=e=>he(!1))},{default:x((()=>[C("生成代码")])),_:1})])]),V(j,{modelValue:me.value,"onUpdate:modelValue":i[18]||(i[18]=e=>me.value=e),width:"70%",title:"组件内容"},{footer:x((()=>[w("div",K,[V(p,{size:"small",onClick:Ne},{default:x((()=>[C("取 消")])),_:1}),V(p,{size:"small",type:"primary",onClick:ye},{default:x((()=>[C("确 定")])),_:1})])])),default:x((()=>[me.value?(h(),B(e,{key:0,ref:"fieldDialogNode","dialog-middle":ne.value},null,8,["dialog-middle"])):z("",!0)])),_:1},8,["modelValue"]),V(j,{modelValue:pe.value,"onUpdate:modelValue":i[20]||(i[20]=e=>pe.value=e)},{header:x((()=>[w("div",Y,[Z,V(p,{size:"small",type:"primary",onClick:ve},{default:x((()=>[C("全选")])),_:1}),V(p,{size:"small",type:"primary",onClick:fe},{default:x((()=>[C("复制")])),_:1})])])),footer:x((()=>[w("div",ee,[V(p,{size:"small",type:"primary",onClick:i[19]||(i[19]=e=>pe.value=!1)},{default:x((()=>[C("确 定")])),_:1})])])),default:x((()=>[pe.value?(h(),B(l,{key:0,ref_key:"previewNode",ref:ce,"preview-code":ae.value},null,8,["preview-code"])):z("",!0)])),_:1},8,["modelValue"])])}}}),[["__scopeId","data-v-bcb13437"]]);export{ae as default};
